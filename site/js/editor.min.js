function Article(){var n=this;n.BaseUrl=BASE_URL+"article/",n.Validated=!1,n.FullScreen=!1,n.Id=ko.observable(0),n.Slug=ko.observable(""),n.Secret=ko.observable(""),n.Shortened=ko.observable(""),n.PublicUrl=ko.observable(""),n.PrivateUrl=ko.observable(""),n.Title=ko.observable(""),n.Markdown=ko.observable(""),n.MarkdownValue=ko.computed({read:function(){return n.Markdown()},write:function(t){n.Markdown(HtmlDecode(t))},owner:n}),n.Html=ko.observable(""),n.Name=ko.observable(""),n.Email=ko.observable(""),n.Site=ko.observable(""),n.Twitter=ko.observable(""),n.CommentsEnabled=ko.observable(!0),n._CreatedAt=ko.observable(""),n.Description=ko.observable(""),n.Keywords=ko.observable(""),n.Tab=ko.observable(0),n.Success=ko.computed({read:function(){return $("#success").html()},write:function(n){$("#success").html(n).slideDown("fast"),$("#publish-button").addClass("success"),setTimeout(function(){$("#publish-button").removeClass("success"),$("#success").slideUp("fast")},1e4)}}),n.Message=ko.computed({read:function(){return $("#message").html()},write:function(n){$("#message").html(n).slideDown("fast"),$("#publish-button").addClass("error"),setTimeout(function(){$("#publish-button").removeClass("error"),$("#message").slideUp("fast")},1e4)}}),n.Publishing=ko.observable(!1),n.PublishStatus=ko.observable(""),n.PublishLabel=ko.computed(function(){return n.Id()!==0?"Save":"Publish"}),n.Created=ko.computed(function(){return n._CreatedAt()!==""?moment(n._CreatedAt()).format("LL"):moment().format("LL")}),n.By=ko.computed(function(){var t="";return n.Name()!==""&&n.Email()!==""?t="by <a href='mailto:"+n.Email()+"'>"+n.Name()+"<\/a>":n.Name()!==""?t="by "+n.Name():n.Email()!==""&&(t="by <a href='mailto:"+n.Email()+"'>"+n.Email()+"<\/a>"),t+" on "+n.Created()}),n.Mailto=ko.computed(function(){return"mailto:"+n.Email()}),n.TwitterLink=ko.computed(function(){return"http://www.twitter.com/"+n.Twitter()}),n.SiteAndTwitter=ko.computed(function(){return n.Site()!==""&&n.Twitter()!==""?"<a href='//"+n.Site()+"'>"+n.Site()+"<\/a> / <a href='http://twitter.com/"+n.Twitter()+"'>@"+n.Twitter()+"<\/a>":n.Site()!==""?"<a href='//"+n.Site()+"'>"+n.Site()+"<\/a>":n.Twitter()!==""?"<a href='http://twitter.com/"+n.Twitter()+"'>@"+n.Twitter()+"<\/a>":void 0}),n.ToggleFullScreen=function(){var t=200;n.FullScreen?($("#menu").slideDown(t),$("input[name=title]").slideDown(t),$("#editor").animate({width:"50%",top:60},t),$("input[name=title]").slideDown(t)):($("#menu").slideUp(t),$("input[name=title]").slideUp(t),$("#editor").animate({width:"100%",top:0},t)),n.FullScreen=!n.FullScreen},n.ShowWelcome=function(){return n.Title()===""&&n.Markdown()===""},n.Compile=function(){n.Html(marked.setOptions({sanitize:!0,breaks:!0,langPrefix:"",highlight:function(n,t){try{return hljs.highlight(t,n).value}catch(i){return hljs.highlightAuto(n).value}}})(n.Markdown()))},n.Publish=function(){n.Id()===0?n.Insert():n.Update(),$(window).unbind("beforeunload")},n.Insert=function(){if(n.Validate()){n.Publishing(!0);var t=ko.toJSON(n);$.ajax({type:"POST",url:n.BaseUrl,contentType:"application/json",data:t,dataType:"json"}).done(function(t){n.Id(t.Id),n.PublicUrl(t.PublicUrl),n.PrivateUrl(t.PrivateUrl),n.Slug(t.Slug),n.Secret(t.Secret),n.PublishStatus("Done."),n.Tab(4),n.InjectAddThis(),n.Publishing(!1),n.Success("<ul><li><b>Success!<\/b> Your post is now published.<\/li><\/ul>")}).error(function(){n.Publishing(!1),n.Message("<ul><li><b>Oops!<\/b> Something went wrong! Please, try again later.<\/li><\/ul>")})}},n.Update=function(){if(n.Secret()!=""&&n.Validate()){n.Publishing(!0);var t=ko.toJSON(n);$.ajax({type:"PUT",url:n.BaseUrl+n.Secret(),data:t,contentType:"application/json",dataType:"json"}).done(function(t){n.Slug(t.Slug),n.PublicUrl(t.PublicUrl),n.PrivateUrl(t.PrivateUrl),n.PublishStatus("Saved."),n.InjectAddThis(),n.Publishing(!1),n.Success("<ul><li>Article saved.<\/li><\/ul>")}).error(function(){n.Publishing(!1),n.Message("<ul><li><b>Oops!<\/b> Something went wrong! Please, try again later.<\/li><\/ul>")})}},n.Delete=function(){confirm("Are you sure? This cannot be undone.")&&$.ajax({type:"DELETE",url:n.BaseUrl+n.Secret()}).done(function(){$(window).unbind("beforeunload"),window.location=SITE_URL}).error(function(){n.Message("<ul><li><b>Oops!<\/b> Something went wrong! Please, try again later.<\/li><\/ul>")})},n.Validate=function(){var t="";return n.Validated=!0,n.Title()===""&&(t+="<li>Title is required<\/li>"),n.Markdown()===""&&(t+="<li>Body is required<\/li>"),$("#aboutyou-form").parsley("isValid")==!1&&(t+='<li>Please fix errors in "Options" tab.<\/li>'),t!==""?(n.Message("<ul>"+t+"<\/ul>"),t===""):(n.Message(""),!0)},n.InjectAddThis=function(){if(n.PublicUrl()!==""){addthis_share={url:n.PublicUrl(),title:n.Title()},addthis_config={},addthis_config.data_track_addressbar=!1,addthis_config.data_track_clickback=!1,addthis_config.ui_language="en";var t=document.createElement("script");t.type="text/javascript",t.src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-505b39b410fa5f3b",document.getElementsByTagName("head")[0].appendChild(t)}},n.Markdown.subscribe(function(){MarkdownDidChange=!0,$(window).unbind("beforeunload").bind("beforeunload",function(){return"There seems to be unsaved changes."})})}function Init(n){ko.applyBindings(n),n.InjectAddThis(),Editor=CodeMirror.fromTextArea(document.getElementById("codemirror_editor"),{lineWrapping:!0,viewportMargin:Infinity}),Preview(n),setInterval(function(){Preview(n)},1e3),shortcut.add("Ctrl+F",function(){n.ToggleFullScreen()}),shortcut.add("ESC",function(){n.FullScreen&&n.ToggleFullScreen()}),shortcut.add("Ctrl+S",function(){n.Publish()}),shortcut.add("Ctrl+1",function(){n.Tab(0)}),shortcut.add("Ctrl+2",function(){n.Tab(1)}),shortcut.add("Ctrl+3",function(){n.Tab(2)}),shortcut.add("Ctrl+4",function(){n.Tab(3)})}function Preview(n){(Editor&&Editor.save(),n.Markdown($("#codemirror_editor").val()),MarkdownDidChange)&&(MarkdownDidChange=!1,n.Compile(),SetBuffer(n.Html()))}function SetBuffer(n,t){var r=$(CurrentBuffer),u=$(n).find("img").size(),f=0,i;if(r.html(n),u===0){SwitchBuffer(),t&&t();return}i=function(){f++,f===u&&(SwitchBuffer(),t&&t())},r.find("img").load(i).error(i)}function SwitchBuffer(){var n=CurrentBuffer==="#buffer1"?"#buffer2":"#buffer1";$(CurrentBuffer).toggle(),$(n).toggle(),CurrentBuffer=n,$(CurrentBuffer).html("")}function HtmlDecode(n){var t=document.createElement("div");return t.innerHTML=n,t.childNodes.length===0?"":t.childNodes[0].nodeValue}var MarkdownDidChange=!0,CurrentBuffer="#buffer2",Editor=null;ko.bindingHandlers.fadeVisible={init:function(n,t){var i=t();$(n).toggle(ko.utils.unwrapObservable(i))},update:function(n,t){var i=t();ko.utils.unwrapObservable(i)?$(n).fadeIn(200):$(n).hide()}};
//@ sourceMappingURL=editor.min.js.map